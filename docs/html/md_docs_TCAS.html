<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XPMP2: TCAS and AI/multiplayer Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XPMP2
   </div>
   <div id="projectbrief">X-Plane multiplayer library 2 - using instancing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TCAS and AI/multiplayer Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="namespaceXPMP2.html">XPMP2</a> provides TCAS blibs and AI/multiplayer data using <a href="https://developer.x-plane.com/article/overriding-tcas-and-providing-traffic-information/">TCAS Override</a> introduced with X-Plane 11.50 Beta 8. Please do read <a href="https://developer.x-plane.com/article/overriding-tcas-and-providing-traffic-information/">that blog post by Laminar</a> as it explains all what's necessary and what also <a class="el" href="namespaceXPMP2.html">XPMP2</a> does:</p>
<ul>
<li>Try acquiring TCAS control via a call to <a href="https://developer.x-plane.com/sdk/XPLMPlanes/#XPLMAcquirePlanes"><code>XPLMAcquirePlanes</code></a>. All what follows only happens if <a class="el" href="namespaceXPMP2.html">XPMP2</a> was granted access:</li>
<li>Sets <code>sim/operation/override/override_TCAS</code> to 1 to tell X-Plane that it will use TCAS Override</li>
<li>Sets <code>sim/operation/override/override_multiplayer_map_layer</code> to 1 to tell X-Plane that it shall not draw icons into the map as <a class="el" href="namespaceXPMP2.html">XPMP2</a> provides a self-defined additional map layer</li>
<li>All aircraft are sorted by distance (biased by <code><a class="el" href="classXPMP2_1_1Aircraft.html#a28c6f513b396f95c6ca90e3d3e4d927c" title="Priority for display in one of the limited number of TCAS target slots.">XPMP2::Aircraft::aiPrio</a></code>), for each aircraft a number of dataRefs are set, see below</li>
<li>In a call to <code>XPLMSetActiveAircraftCount</code> X-Plane is informed about the exact number of provided planes. (This might not be strictly necessary, but probably a cleaner approach than to wait 10 cylces for not updated dataRefs to be taken out of X-Plane's consideration.)</li>
</ul>
<p>When TCS Override is not available (like up to X-Plane 11.41), then TCAS is provided by writing the classic multiplayer dataRefs directly.</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Slotting</h1>
<p>There is a limited number of "slots" available for TCAS/multiplayer purposes. With TCAS Override, this is currently 63, with classic multiplayer dataRefs, this is up to 19, though for many 3rd party plugins the number of actually configured AI Aircraft (X-Planes Flight Setup) plays a role, too.</p>
<p><a class="el" href="namespaceXPMP2.html">XPMP2</a> will show the aircraft closest to current camera location. This set of aircraft will change over time. But <a class="el" href="namespaceXPMP2.html">XPMP2</a> will try to keep a plane, which once was shown on TCAS, in the same slot to make it easier for 3rd party plugins to follow one plane.</p>
<p>Keeping a plane in one slot has limits. The following rules apply:</p><ul>
<li>TCAS Override (X-Plane 11.50b8 and above): The lower 19 slots are the "lower range" because 3rd party plugins not yet using TCAS Override have access to only these 19.</li>
<li>Fallback with classic dataRefs: The lower <code>n</code> slots, for which AI Aircraft are configured, are considered "lower range" because some 3rd party plugins only access as many planes as are configured as AI Aircraft (though this is unnecessary: plugins could just read all 19 dataRefs irrespective of what <code>XPLMCountAircraft</code> returns.)</li>
<li>This "lower range" is considered higher priority and will be filled up first with closest planes.</li>
<li><a class="el" href="namespaceXPMP2.html">XPMP2</a> will fill a continuous set of slots starting at 1. If a plane is removed, which occupied a slot in the middle then another plane will take it (potentially moving down from the upper range to the lower range).</li>
<li>Also, if a plane is moved between lower and upper range because it moved ranks in the order by distance, then it changes slots.</li>
</ul>
<h1><a class="anchor" id="autotoc_md40"></a>
TCAS Target dataRefs</h1>
<p><a class="el" href="namespaceXPMP2.html">XPMP2</a> writes the folloing TCAS target dataRefs when it has TCAS control:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>.../tcas/targets/</code>   </th><th class="markdownTableHeadNone"><a class="el" href="namespaceXPMP2.html">XPMP2</a>'s value from <code><a class="el" href="classXPMP2_1_1Aircraft.html" title="Actual representation of all aircraft in XPMP2.">XPMP2::Aircraft</a></code>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>modeS_id</code>   </td><td class="markdownTableBodyNone"><code>modeS_id</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>modeC_code</code>   </td><td class="markdownTableBodyNone"><code>acRadar.code</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>flight_id</code>   </td><td class="markdownTableBodyNone">what <code>GetFlightId()</code> returns: <code>acInfoTexts.flightNum</code> or <code>acInfoTexts.tailNum</code> or <code>acInfoTexts.aptFrom</code>-<code>acInfoTexts.aptFrom</code>, whatever is available first; this is a virtual function that you can override in your implementation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>icao_type</code>   </td><td class="markdownTableBodyNone"><code>acIcaoType</code>   </td></tr>
</table>
<p>All dataRefs under <code>sim/cockpit2/tcas/targets/position/</code> are filled as expected and documented except for <code>weight_on_wheels</code>, for which no value in <code><a class="el" href="classXPMP2_1_1Aircraft.html#a8c2ccee83b592cd2a7064a380c660c5b" title="actual dataRef values to be provided to the CSL model">XPMP2::Aircraft::v</a></code> is yet available:</p>
<p>Values are taken from <code><a class="el" href="classXPMP2_1_1Aircraft.html#a8c2ccee83b592cd2a7064a380c660c5b" title="actual dataRef values to be provided to the CSL model">XPMP2::Aircraft::v</a></code>. Compare the indexes as defined in the <code>enum DR_VALS</code> defined in <a href="html/XPMPAircraft_8h.html"><code>XPMPAircraft.h</code></a>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>.../tcas/targets/position/</code>   </th><th class="markdownTableHeadNone"><a class="el" href="namespaceXPMP2.html">XPMP2</a>'s value from <code><a class="el" href="classXPMP2_1_1Aircraft.html" title="Actual representation of all aircraft in XPMP2.">XPMP2::Aircraft</a></code>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>x</code>, <code>y</code>, <code>z</code>   </td><td class="markdownTableBodyNone"><code>drawInfo.x</code>, <code>drawInfo.y - ac.GetVertOfs()</code>, <code>drawInfo.z</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>vx</code>, <code>vy</code>, <code>vz</code>   </td><td class="markdownTableBodyNone">updated once a second with deltas of respective values in <code>drawInfo</code> devided by time passed    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>psi</code>   </td><td class="markdownTableBodyNone"><code>drawInfo.heading</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>the</code>   </td><td class="markdownTableBodyNone"><code>drawInfo.pitch</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>phi</code>   </td><td class="markdownTableBodyNone"><code>drawInfo.roll</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>flap_ratio</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_FLAP_RATIO]</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>gear_deploy</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_GEAR_RATIO]</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>flap_ratio2</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_FLAP_RATIO]</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>speedbrake_ratio</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_SPEED_BRAKE_RATIO]</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>slat_ratio</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_SLAT_RATIO]</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>wing_sweep</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_WING_SWEEP_RATIO]</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>throttle</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_THRUST_RATIO]</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>yolk_pitch</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_YOKE_PITCH_RATIO]</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>yolk_yaw</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_YOKE_HEADING_RATIO]</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>yolk_roll</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_YOKE_ROLL_RATIO]</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>lights</code>   </td><td class="markdownTableBodyNone"><code>v[V_CONTROLS_TAXI_LITES_ON]</code>, <code>v[V_CONTROLS_LANDING_LITES_ON]</code>, <code>v[V_CONTROLS_BEACON_LITES_ON]</code>, <code>v[V_CONTROLS_STROBE_LITES_ON]</code>, <code>v[V_CONTROLS_NAV_LITES_ON]</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>weight_on_wheels</code>   </td><td class="markdownTableBodyNone">-   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md41"></a>
Classic AI/Multiplayer support</h1>
<p>...is provided by X-Plane automatically when feeding above TCAS target dataRefs. That means: The lower 19 planes are mirrored into the well-known <code>sim/multiplayer/position/plane#_*</code> dataRefs. Plugins still relying on these dataRefs will mainly "just work". And this <em>without</em> any workarounds like defining AI Aircraft in X-Plane's settings!</p>
<p>Please note that <a href="https://developer.x-plane.com/sdk/XPLMPlanes/#XPLMCountAircraft"><code>XPLMCountAircraft</code></a> can now return values larger than 20, up to 64 at the moment.</p>
<p><a class="el" href="namespaceXPMP2.html">XPMP2</a> still makes sure that unused <code>sim/multiplayer/position/plane#</code> slots (ie. if less than 19 planes are shown) are initialised with <code>_x/y/z</code> set to <code>9999999.9</code>. They are deliberately <em>not</em> set to <code>0</code> if unused, because 0/0/0 is a totally valid local geographic location. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
