<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XPMP2: XPMP2 Remote Functionality</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XPMP2
   </div>
   <div id="projectbrief">X-Plane multiplayer library 2 - using instancing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceXPMP2.html">XPMP2</a> Remote Functionality </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page explains the technical background of the <a class="el" href="namespaceXPMP2.html">XPMP2</a> Remote functionality. For end user documentation refer to <a href="https://twinfan.gitbook.io/livetraffic/setup/installation/xpmp2-remote-client">LiveTraffic/XPMP2 Remote Client</a> documentation.</p>
<h1><a class="anchor" id="autotoc_md31"></a>
Support in your Plugin</h1>
<p>You do not need to do anything specifically in your plugin to support the Remote functionality. Just build and link with the latest <a class="el" href="namespaceXPMP2.html">XPMP2</a> library. Don't even ship the Remote Client, but refer to the <a href="https://forums.x-plane.org/index.php?/files/file/67797-xpmp2-remote-client/">download location</a>, which is maintained centrally.</p>
<p>Optionally, you <em>could</em> respond to the new <code>XPMP_CFG_ITM_SUPPORT_REMOTE</code> configuration item in your <code>XPMPIntPrefsFuncTy</code> configuration callback function, e.g. to provide the user with an option to switch Remote support on regardless of network configuration. However, the default, "auto-detect", works in by far most scenarios already. And in the few others the users would still have the chance to use the XPMP2.prf config file <a href="https://twinfan.gitbook.io/livetraffic/setup/installation/xpmp2-remote-client#adjusting-network-configuration">as documented</a>.</p>
<p>Optionally, you <em>could</em> react to an inter-plugin message <code>XPLM_MSG_RELEASE_PLANES</code> from the <a class="el" href="namespaceXPMP2.html">XPMP2</a> Remote Client and cede TCAS/AI control in that case because the Remote Client will take care of your TCAS in that case, too, but will also have the chance to pick up planes of other XPMP2-based plugins. See <a href="https://github.com/TwinFan/LiveTraffic/blob/bba4912ebfe3203689e029f1786607ab897fe597/Src/LiveTraffic.cpp#L578">LiveTraffic's XPluginReceiveMessage function</a> for an example.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Basic Ideas</h1>
<ul>
<li>There are <b>senders</b> (the actual XPMP2-based plugins) disseminating position information via UDP multicst into the local network.</li>
<li>There is one centrally provided <b><a class="el" href="namespaceXPMP2.html">XPMP2</a> Remote Client</b> plugin per networked PC, which is part of the <a class="el" href="namespaceXPMP2.html">XPMP2</a> project. This client reads those multicast messages and displays the aircraft in the networked PCs.</li>
<li>The <a class="el" href="namespaceXPMP2.html">XPMP2</a> master shall be independent of the X-Plane master. This would allow to run the <a class="el" href="namespaceXPMP2.html">XPMP2</a> master on another of the networked PCs for load balancing. Or to use the same principle for networked gaming setup with several totally independent players, which still could share the same XPMP2-driven planes.</li>
<li>It is possible to collect multicast data from different XPMP2-driven plugins, even if they run on different PCs. So the Remote Client is able to identify different sources and map their aircraft ids in case they are in conflict.</li>
<li>Standard setup is "zero-config":<ul>
<li>The masters will first <em>listen</em> to the multicast port. As soon as they receive something they will start broadcasting their own data, too.</li>
<li>The clients will first send a "Beacon of interest" message on the multicast address and repeat that every once in a while until they eventually receive actual data.</li>
</ul>
</li>
<li>Masters send their configuration regularly.<ul>
<li>The client needs to replicate relevant configuration settings like logging level, replace dataRefs/textures, label and map settings;</li>
<li>as different masters could be configured differently the client decides for a "best effort" config for each of these items.</li>
</ul>
</li>
<li>The Remote Client requests TCAS/AI right on startup. This is not perfectly in line with <a href="https://developer.x-plane.com/article/overriding-tcas-and-providing-traffic-information/#Plugin_coordination">TCAS plugin coordination rules</a>, but necessary so that the Remote Client can actually combine all the other plugins' position data into one central TCAS/AI stream.</li>
<li>The network messages include per plane:<ul>
<li>Position, attitude</li>
<li>Model (the client needs to have the same set of CSL models installed, and it still needs to be able to do its own matching in case the requested model is not accessible)</li>
<li>Configuration, ie. the array of animation dataRefs</li>
<li>To save network bandwidth data compression is applied:<ul>
<li>Full data set only every once in a while (so that clients have a chance to fully synch with a new plane),</li>
<li>diff data only inbetween, animation dataRefs only if they really change...</li>
</ul>
</li>
</ul>
</li>
<li>Special situations handled specially:<ul>
<li>Change of visibility</li>
<li>Change of CSL model</li>
<li>Removal of aircraft</li>
<li>Stale aircraft (not updated in some time)</li>
<li>Stale sender (not sending in some time)</li>
</ul>
</li>
<li>Read an <em>optional</em> config file to be able to change a few parameters and enforce network functionality<ul>
<li>Read by all XPMP2-based plugins, including Remote Client</li>
<li>Example provided as Resources/XPMP2.example.prf</li>
<li>Includes switch on/off/auto, port, multicast address, max msg length</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md33"></a>
Application Architecture</h1>
<p><img src="pic/XPMP2_Remote_Architecture.png" alt="XPMP2 Remote Architecture" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md34"></a>
Network Message "Protocol"</h1>
<ul>
<li>Plugin's settings <code>RemoteMsgSettingsTy</code> (grey)<ul>
<li>are sent every 20 seconds,</li>
<li>contain plugin information like its name,</li>
<li>contain relevant configuration settings,</li>
<li>are used by the Remote Client to learn about senders; planes can only be processed from known senders.</li>
</ul>
</li>
<li>Fully detailed <code>RemoteMsgAcDetailTy</code> messages (green)<ul>
<li>contain information for several planes, each plane occupying a fixed-length "record" in the message,</li>
<li>introduces new planes (the plane icon in the bottom row),</li>
<li>are regularly sent every 10s per plane, all planes equally distributed over this 10 second period,</li>
<li>allows the Remote Client to create new planes and fully synchronize all data every 10 seconds.</li>
</ul>
</li>
<li>Position update <code>RemoteMsgAcPosUpdateTy</code> messages (blue)<ul>
<li>contain information for several planes, each plane occupying a fixed-length "record" in the message,</li>
<li>include differential position updates only for space efficiency,</li>
<li>can be processed by the Remote Client only for already known planes.</li>
</ul>
</li>
<li>Animation dataRef <code>RemoteMsgAcAnimTy</code> messages (orange)<ul>
<li>contain information for several planes,</li>
<li>are variable-length even per plane as only actually changed dataRef values are included as key/value pairs,</li>
<li>all values are reduced from <code>float</code> to 8 bit <code>uint8_t</code> values for space efficiency,</li>
<li>can be processed by the Remote Client only for already known planes.</li>
</ul>
</li>
<li>Plane removal <code>RemoteMsgAcRemoveTy</code> messages (red)<ul>
<li>contain information for several planes, each plane identified by an internal id only,</li>
<li>inform the Remote Client to remove that plane.</li>
</ul>
</li>
</ul>
<p><img src="pic/XPMP2_Remote_Messages.png" alt="XPMP2 Network Messages" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
