<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XPMP2: Model Matching</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XPMP2
   </div>
   <div id="projectbrief">X-Plane multiplayer library 2 - using instancing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Model Matching </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>"Model Matching" describes how <a class="el" href="namespaceXPMP2.html">XPMP2</a> picks one of the installed CSL models to <em>match</em> with what your plugins would like to draw into the simulator's sky. Users will have installed a varying amount of CSL models from which <a class="el" href="namespaceXPMP2.html">XPMP2</a> can choose.</p>
<p>Matching takes place</p><ul>
<li>upon creation of a new plane, preferably by instantiating a new object of your aircraft class derived from <a href="html/classXPMP2_1_1Aircraft.html"><code>XPMP2::Aircraft</code></a>,</li>
<li>when specifically instructed, e.g. by calling <code><a class="el" href="classXPMP2_1_1Aircraft.html#a8b79245eb13698da96e1239c010ec3bc" title="(Potentially) changes the plane&#39;s model after doing a new match attempt">XPMP2::Aircraft::ChangeModel</a></code> or <code><a class="el" href="classXPMP2_1_1Aircraft.html#adb51258e5d6db1652ddc889afbe384b4" title="Finds a match again, using the existing parameters, eg. after more models have been loaded.">XPMP2::Aircraft::ReMatchModel</a></code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md28"></a>
Input</h1>
<p>Matching is based on 3 input parameters:</p><ul>
<li>The ICAO <b>aircraft type designator</b> of the plane,</li>
<li>the ICAO <b>operator code</b> to identify the airline,</li>
<li>a text to identify a <b>special livery</b>.</li>
</ul>
<p>All parameters are optional. Pass an empty string if you can't provide details.</p>
<p>Internally, a fourth parameter named <b>related group</b> is added, derived from the ICAO aircraft type designator: There are many similar looking aircraft models in the world...just think of A319, A320, A321. The <code>related.txt</code> files combines all similar looking models into one line, which make up such a group. Each aircraft type is allowed to appear at maximum once in the entire file. The idea is to use a A320 model if a necessary A319 model is not available.</p>
<p>Aircraft / airline / livery combinations available for the user are listed in the <code>xsb_aircraft.txt</code> files in the user's CSL model folders. <a class="el" href="namespaceXPMP2.html">XPMP2</a> reads all of these files into a cache when your plugin calls <code>XPMPLoadCSLPackage</code>, i.e. typically at startup.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Procedure</h1>
<p>Model Matching now compares 10 attributes between the parameters you pass during aircraft creation and the available models. They are rated according to the following priority from broad to fine-grained attributes:</p>
<ol type="1">
<li>"has rotor" - this avoids picking a winged model for a helicopter</li>
<li>ICAO aircraft class type - landplane, seaplane, helicopter, ...</li>
<li>Wake Turbulence Category - a good rough general size indicator</li>
<li>Number of engines</li>
<li>Engine type - jet, turbo, piston</li>
<li>Related group - see above, groups similar-looking models like A319, A320, A321</li>
<li>ICAO airline / operator and related group together match (this means that a "related" model with matching livery is preferred over an exactly matching aircraft with wrong livery)</li>
<li>ICAO aircraft type designator - like A320, A388, B738, B741, C172, MD82, ..</li>
<li>ICAO airline / operator - like AAL, AFR, BAW, DLH, SWA, WJA, ...</li>
<li>Special Livery</li>
</ol>
<p>The better a potential CSL model matches with the passed-in parameters the more of the above attributes match, the higher is the "match quality". Higher priority attributes count more than lower ones: technically it is a bit mask with the number 1 attribute at the most significant bit.</p>
<p>The model with the best match quality is picked. If there are several models ending up with the same match quality, then <a class="el" href="namespaceXPMP2.html">XPMP2</a> takes a random pick. This often happens if there are several models available for the expected ICAO aircraft type designator, but none of them has the correct livery for the requested operator.</p>
<p>There is no "default" livery any longer as there was in <code>libxplanemp</code>. The downside is that it is a bit harder to identify non-matching liveries: Asking twice with the same match parameters can end in different models being picked.</p>
<h1><a class="anchor" id="autotoc_md30"></a>
Logging</h1>
<p>If you are interested in how models are picked then you can activate logging of model matching: In your configuration callback return <code>1</code> for key <code>XPMP_CFG_ITM_MODELMATCHING</code> and <code>0</code> or <code>1</code> for key <code>XPMP_CFG_ITM_LOGLEVEL</code>.</p>
<p>With model matching logging activated, <a class="el" href="namespaceXPMP2.html">XPMP2</a> writes info into <code>Log.txt</code> like this:</p>
<div class="fragment"><div class="line">.../CSLFindMatch: MATCH INPUT: Type=BE36 (WTC=L,Class=L1P,Related=128), Airline=N13, Livery=N136HP</div>
<div class="line">.../CSLFindMatch: MATCH FOUND: Type=BE20 (WTC=L,Class=L2T,Related=128), Airline=SLG, Livery= / Quality = 56 -&gt; model BB_GA/BE20_CGSAE</div>
<div class="line"> </div>
<div class="line">.../CSLFindMatch: MATCH INPUT: Type=B737 (WTC=M,Class=L2J,Related=56), Airline=SWA, Livery=N462WN</div>
<div class="line">.../CSLFindMatch: MATCH FOUND: Type=B737 (WTC=M,Class=L2J,Related=56), Airline=SWA, Livery= / Quality = 2 -&gt; model BB_Boeing/B737_SWA</div>
<div class="line"> </div>
<div class="line">.../CSLFindMatch: MATCH INPUT: Type=DHC6 (WTC=L,Class=L2T,Related=108), Airline=CVU, Livery=N190GC</div>
<div class="line">.../CSLFindMatch: MATCH FOUND: Type=BE20 (WTC=L,Class=L2T,Related=128), Airline=JEI, Livery= / Quality = 16 -&gt; model BB_GA/BE20_DIKOB</div>
<div class="line"> </div>
<div class="line">.../CSLFindMatch: MATCH INPUT: Type=H500 (WTC=L,Class=H1T,Related=177), Airline=N91, Livery=N911WY</div>
<div class="line">.../CSLFindMatch: MATCH FOUND: Type=B06 (WTC=L,Class=H1T,Related=177), Airline=PAT, Livery= / Quality = 8 -&gt; model BB_Heli/B06_US3_31A</div>
</div><!-- fragment --><p>Note that "quality" is reported inverse here in <code>Log.txt</code> (as it is used in <a class="el" href="namespaceXPMP2.html">XPMP2</a>'s code): Lower numbers are better matches.</p>
<p>For example: The first match (Quality = 56) is a comparably bad one... just look at the aircraft class: Wanted is a "L1P" aircraft (one piston engine), the best we found is an L2T (two turbo engines). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
