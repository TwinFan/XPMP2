<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XPMP2: Copying &lt;tt&gt;.obj&lt;/tt&gt; Files for Replacing Animation dataRefs and Textures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XPMP2
   </div>
   <div id="projectbrief">X-Plane multiplayer library 2 - using instancing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Copying <code>.obj</code> Files for Replacing Animation dataRefs and Textures </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CSL packages come in different flavours. Popular ones for general use are the Bluebell and the X-CSL packages. Both come with different history. For <a class="el" href="namespaceXPMP2.html">XPMP2</a> to use all their features it needs to change their <code>.obj</code> files. Performing these changes is built into <a class="el" href="namespaceXPMP2.html">XPMP2</a>.</p>
<ul>
<li><a href="https://forums.x-plane.org/index.php?/files/file/37041-bluebell-obj8-csl-packages/">The Bluebells</a> have not migrated newer animation dataRefs from their World Traffic origins to the <a href="CSLdataRefs.html">now available <code>libxplanemp</code> names</a>, which means that animations already existing in the models (like props, rotors, wheels, reversers) cannot be controlled by <a class="el" href="namespaceXPMP2.html">XPMP2</a>.</li>
<li><a href="https://csl.x-air.ru/?lang_id=43">X-CSL</a> avoids shipping one <code>.obj</code> per texture and instead uses an extended <code>OBJ8</code> command syntax in the <code>xsb_aircraft.txt</code> file to name the texture to use. Any kind of "dynamic
  change of the texture to use" cannot be supported with instancing any longer. Instancing requires one <code>.obj</code> file to be readily available for loading.</li>
</ul>
<p>Previously, the <a href="https://github.com/TwinFan/CSL2XSB"><code>CSL2XSB.py</code> script</a> performed the necessary changes. But executing it was an additional step too complex for some users, and required the user to have Python 3 installed.</p>
<p>Now, <a class="el" href="namespaceXPMP2.html">XPMP2</a> includes the required operation as well, which will be applied to <code>.obj</code> files shortly before they are loaded as an instances, ie. only for models which are actually used.</p>
<p>Two kinds of operations happen and a plugin using <a class="el" href="namespaceXPMP2.html">XPMP2</a> can control via configuration if they shall be applied. See the <code>XPMPIntPrefsFuncTy</code> type definition in <a href="html/XPMPMultiplayer_8h.html">XPMPMultiplayer.h</a> or the <code><a class="el" href="XPMP2-Sample_8cpp.html" title="Example plugin demonstrating XPMP2 techniques.">XPMP2-Sample.cpp</a></code> code for <code><a class="el" href="XPMP2-Remote_8cpp.html#accfea755be3f58d51c57997005b7a114">CBIntPrefsFunc()</a></code>. The following configuration values play a role:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">section   </th><th class="markdownTableHeadNone">key&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;   </th><th class="markdownTableHeadNone">type   </th><th class="markdownTableHeadNone">default   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">models&#160;   </td><td class="markdownTableBodyNone">replace_datarefs&#160;&#160;&#160;   </td><td class="markdownTableBodyNone">int&#160;   </td><td class="markdownTableBodyNone">&#160;&#160;&#160;0&#160;&#160;&#160;   </td><td class="markdownTableBodyNone">Replace dataRefs in OBJ8 files upon load, creating new OBJ8 files for <a class="el" href="namespaceXPMP2.html">XPMP2</a> (<b>defaults to OFF!</b>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">models&#160;   </td><td class="markdownTableBodyNone">replace_texture&#160;&#160;&#160;&#160;   </td><td class="markdownTableBodyNone">int&#160;   </td><td class="markdownTableBodyNone">&#160;&#160;&#160;1&#160;&#160;&#160;   </td><td class="markdownTableBodyNone">Replace textures in OBJ8 files upon load if needed (specified on the OBJ8 line in xsb_aircraft.txt), creating new OBJ8 files   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md7"></a>
General Notes on Copied Files</h1>
<p>If copying takes place, then a new <code>.obj</code> file is written into the same folder next to the original one. The file name of the copy is as follows:</p><ul>
<li>If the file is created for a specific texture, then the texture's file name (without extension) is added to the file name before the extension.</li>
<li>The extension will always be <code>.xpmp2.obj</code> instead of just <code>.obj</code>.</li>
</ul>
<p><b>For example</b>, X-CSL defines the Lufthansa A320 as follows in <code>A320/xsb_aircraft.txt</code>: </p><div class="fragment"><div class="line">OBJ8_AIRCRAFT A320:DLH</div>
<div class="line">OBJ8 GLASS YES A320:A320fCFMfan.obj</div>
<div class="line">OBJ8 SOLID YES A320:A320fCFM.obj DLH.png A320fCFM_LIT.png</div>
<div class="line">VERT_OFFSET 0.0</div>
<div class="line">AIRLINE A320 DLH</div>
</div><!-- fragment --><p>The copying operation will create the following two new files:</p><ul>
<li><code>A320fCFMfan.xpmp2.obj</code> as a copy for the fan model.<br  />
 This file has no additional texture specifications, so all livery variations share just one copy. If the copy exists already it will certainly not be copied again.</li>
<li><code>A320fCFM.DLH.xpmp2.obj</code> as a copy for the fuselage, referencing the <code>DLH.png</code> and <code>A320fCFM_LIT.png</code> textures.</li>
</ul>
<p>Each copied file includes a comment in line 4 stating its origin: </p><div class="fragment"><div class="line"># Created by &lt;PluginLogAcronym&gt;/XPMP2 based on Resources/plugins/LiveTraffic/Resources/X-CSL/A320/A320fCFMfan.obj</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8"></a>
Replacing dataRefs</h1>
<p>This is <b>off by default</b>, because well curated packages won't need it. To enable it return 1 when called for configuration item <code>XPMP_CFG_ITM_REPLDATAREFS</code>.</p>
<p>When enabled, a copy for each <code>.obj</code> file will be created just before it is to be loaded. In each copy, dataRefs are replaced based on the definition in <code>&lt;resourceDir&gt;/Obj8DataRefs.txt</code>. That file just lists dataRef names to be replaced with the replacement dataRef like this: </p><div class="fragment"><div class="line">cjs/world_traffic/engine_rotation_angle1        libxplanemp/engines/engine_rotation_angle_deg1</div>
<div class="line">cjs/world_traffic/main_gear_deflection          libxplanemp/gear/tire_vertical_deflection_mtr</div>
</div><!-- fragment --><p> The <code>Obj8DataRefs.txt</code> file available with <a class="el" href="namespaceXPMP2.html">XPMP2</a> defines a number of replacements to unlock more features in the Bluebell CSL models. The simple text format allows you to add/change replacement definitions easily and ship your version with your plugin.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Replacing Texture</h1>
<p>This is <b>on by default</b>. You could switch it off by returning <code>0</code> when asked for configuration item <code>XPMP_CFG_ITM_REPLTEXTURE</code>.</p>
<p>A copy will only be initiated if additional textures are defined as 4th (and optionally 5th) parameter with the <code>OBJ8</code> command in <code>xsb_aircraft.txt</code>.</p>
<p>The copy will then state those defined textures in the <code>TEXTURE</code> resp. <code>TEXTURE_LIT</code> commands of the <code>.obj</code> file.</p>
<p>For the Lufthansa A320 example above the <code>TEXTURE</code> lines will look like this: </p><div class="fragment"><div class="line">TEXTURE DLH.png</div>
<div class="line">TEXTURE_LIT A320fCFM_LIT.png</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
