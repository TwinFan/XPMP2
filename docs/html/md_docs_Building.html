<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XPMP2: Building XPMP2 and the Sample Plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XPMP2
   </div>
   <div id="projectbrief">X-Plane multiplayer library 2 - using instancing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building <a class="el" href="namespaceXPMP2.html">XPMP2</a> and the Sample Plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a href="https://github.com/TwinFan/XPMP2">XPMP2 Library</a> and the [XPMP2-Sample plugin]/https://github.com/TwinFan/XPMP2-Sample) are now two separate GitHub repositories.</p>
<p>It is recommended that you include <code><a class="el" href="namespaceXPMP2.html">XPMP2</a></code> as a submodule in your project.</p>
<p>The <code>XPMP2-Sample</code> repo is configured as a <em>Public Template</em>, so you can immediately <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-repository-from-a-template">base your own project on it</a>. Please note that <code>XPMP2-Sample</code> includes <code><a class="el" href="namespaceXPMP2.html">XPMP2</a></code> as a submodule, so you need to checkout those, too, e.g. on the command line by doing </p><div class="fragment"><div class="line">git clone --recurse-submodules https://github.com/TwinFan/XPMP2-Sample</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Build options</h1>
<p>Both repositories share many similarities when it comes to building. There are four options to build from sources:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Options   </th><th class="markdownTableHeadNone">Windows   </th><th class="markdownTableHeadNone">MacOS (universal)   </th><th class="markdownTableHeadNone">Linux    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IDE</b>   </td><td class="markdownTableBodyNone">Visual Studio 2022   </td><td class="markdownTableBodyNone">XCode 12   </td><td class="markdownTableBodyNone">-    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Docker</b>   </td><td class="markdownTableBodyNone">Mingw64   </td><td class="markdownTableBodyNone">clang, SDK 12   </td><td class="markdownTableBodyNone">Focal and Bionic    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>CMake</b>   </td><td class="markdownTableBodyNone">VS 2022 / <code>NMAKE</code>   </td><td class="markdownTableBodyNone">XCode 12 / <code>ninja</code>   </td><td class="markdownTableBodyNone">Focal and Bionic / <code>ninja</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Github Actions</b>   </td><td class="markdownTableBodyNone">Visual Studio 2022   </td><td class="markdownTableBodyNone">XCode 12   </td><td class="markdownTableBodyNone">Focal   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md3"></a>
Using an IDE</h1>
<h2>Windows</h2>
<ul>
<li>Install <a href="https://visualstudio.microsoft.com/vs/community/">Visual Studio</a></li>
<li>Open the root folder of the repo using "File &gt; Open &gt; Folder", <a href="https://docs.microsoft.com/en-us/cpp/build/open-folder-projects-cpp?view=vs-2019">see here for VS's "Open Folder" functionality</a>)</li>
<li>VS use the CMake setup to configure building the binaries.</li>
<li>Build from within Visual Studio.</li>
</ul>
<p>Results are in <code>build-win</code>.</p>
<h2>MacOS</h2>
<p>My development environment is Mac OS, so expect the XCode environment to be maintained best. Open <code>XPMP2.xcodeproj</code> resp. <code>XPMP2-Sample.xcodeproj</code> in XCode.</p>
<p>In the <code>XPMP2-Sample</code> XCode Build Settings you may want to change the definition of the User-Defined build macro <code>XPLANE11_ROOT</code>: Put in the path to your X-Plane 11 installation's root path, then the <a class="el" href="namespaceXPMP2.html">XPMP2</a> binaries will be installed right there in the appropriate <code>Resources/plugins</code> sub-folder structure.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Using Docker</h1>
<p>Docker environments based on Ubuntu 20.04 and 18.04 are used, which can build all 3 platforms, Linux even in two flavors.</p>
<ul>
<li>Install <a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a> and start it.</li>
<li><code>cd</code> to the project's <code>docker</code> folder, and enter <code>make</code> for all <a class="el" href="namespaceXPMP2.html">XPMP2</a> library targets on all platforms.</li>
</ul>
<p>The following <code>make</code> targets are available:</p>
<ul>
<li><code>lin</code> builds Linux on Ubuntu 20.04</li>
<li><code>lin-bionic</code> builds Linux on Ubuntu 18.04</li>
<li><code>mac-arm</code> builds MacOS for Apple Silicon using <code>clang</code> as cross compiler</li>
<li><code>mac-x86</code> builds MacOS for x86 using <code>clang</code> as cross compiler</li>
<li><code>mac</code> builds <code>mac-arm</code> and <code>mac-x86</code> and then combines the results into a univeral binary</li>
<li><code>win</code> builds Windows using a Mingw64 cross compiler setup</li>
<li><code>bash_focal</code> starts a bash prompt in the Ubuntu 20.04 docker container</li>
<li><code>bash_bionic</code> starts a bash prompt in the Ubuntu 18.04 docker container</li>
<li><code>doc</code> builds the documentation based on Doxygen, will probably only work on a Mac with Doxygen provided in <code>Applications/Doxygen.app</code></li>
<li><code>clean</code> removes all <code>build-&lt;platform&gt;</code> folders</li>
</ul>
<p>Find results in the respective <code>build-&lt;platform&gt;</code> folder, the <code><a class="el" href="namespaceXPMP2.html">XPMP2</a></code> library right there, the Sample plugins in their proper <code>&lt;platform&gt;_x64</code> subfolder.</p>
<p>For more details and background information on the provided Docker environments see the <code>docker/README.md</code>.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Using CMake</h1>
<p>Given a proper local setup with a suitable compiler, CMake, and Ninja installed, you can just locally build the sources from the <code>CMakeList.txt</code> file, e.g. like this:</p>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake -G Ninja ..</div>
<div class="line">ninja</div>
</div><!-- fragment --><p>This is precicely how the Mac and Linux builds are done in Github Actions.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Using Gitub Actions</h1>
<p>The GitHub workflow <code>.github/workflows/build.yml</code> builds the plugin in GitHubs CD/CI environment. <code>build.yml</code> calls a number of custom composite actions available in <code>.github/actions</code>, each coming with its own <code>README.md</code>.</p>
<p>The workflow builds Linux, MacOS, and Windows plugin binaries and provides them as artifacts, so you can download the result from the <em>Actions</em> tab on GitHub.</p>
<h2>Apple: Sign and Notiarize</h2>
<p>The Apple build of the <code>XPMP2-Sample</code> plugin can be signed and notarized, provided that the following <em>Repository Secrets</em> are defined in the repository's settings (Settings &gt; Secrets &gt; Actions):</p><ul>
<li><code>MACOS_CERTIFICATE</code>: Base64-encoded .p12 certificate as <a href="https://localazy.com/blog/how-to-automatically-sign-macos-apps-using-github-actions#lets-get-started">explained here</a></li>
<li><code>MACOS_CERT_PWD</code>: The password for the above .p12 certificate file export</li>
<li><code>NOTARIZATION_USERNAME</code>: Apple ID for notarization service (parameter <code>--apple-id</code> to <code>notarytool</code>)</li>
<li><code>NOTARIZATION_TEAM</code>: Team ID for notarization service (parameter <code>--team-id</code> to <code>notarytool</code>)</li>
<li><code>NOTARIZATION_PASSWORD</code>: <a href="https://support.apple.com/en-gb/HT204397">App-specific password</a> for notarization service (parameter <code>--password</code> to <code>notarytool</code>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
Including XPMP2 directly in GitHub project and CMake builds</h1>
<p>You can avoid separate builds and instead include <code><a class="el" href="namespaceXPMP2.html">XPMP2</a></code> directly into your project. Recommended steps are:</p>
<ol type="1">
<li>Include <a class="el" href="namespaceXPMP2.html">XPMP2</a> as a Github Submodule into your Github project, using something like ``&lsquo; git submodule add --name <a class="el" href="namespaceXPMP2.html">XPMP2</a> '<a href="https://github.com/TwinFan/XPMP2&rsquo;">https://github.com/TwinFan/XPMP2&amp;rsquo;</a> lib/XPMP2 ``` To update your local version with changes from the <a class="el" href="namespaceXPMP2.html">XPMP2</a> repository run something like ``` git submodule update &ndash;remote ``<code></code></li>
<li><code>In your</code>CMakeLists.txt` file include <a class="el" href="namespaceXPMP2.html">XPMP2</a> using something like the following in appropriate places:<ol type="a">
<li>If needing FMOD sound support first define ``` set (INCLUDE_FMOD_SOUND 1) <br  />
 add_compile_definitions(INCLUDE_FMOD_SOUND=1) include_directories("${CMAKE_CURRENT_SOURCE_DIR}/lib/XPMP2/lib/fmod/logo") target_sources(${CMAKE_PROJECT_NAME} lib/XPMP2/lib/fmod/logo/FMOD_Logo.cpp) ```</li>
<li>Including building <a class="el" href="namespaceXPMP2.html">XPMP2</a> as follows: ``` include_directories("${CMAKE_CURRENT_SOURCE_DIR}/lib/XPMP2/inc") add_subdirectory(lib/XPMP2) add_dependencies(${CMAKE_PROJECT_NAME} <a class="el" href="namespaceXPMP2.html">XPMP2</a>) target_link_libraries(${CMAKE_PROJECT_NAME} <a class="el" href="namespaceXPMP2.html">XPMP2</a>) ``` </li>
</ol>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
